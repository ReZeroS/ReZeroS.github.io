<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="ReZero"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://rezeros.github.io/2020/03/07/init-chrome-plugin/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="Before that, think more."><meta property="og:type" content="article"><meta property="og:title" content="如何写一个简易的chrome插件"><meta property="og:url" content="https://rezeros.github.io/2020/03/07/init-chrome-plugin/index.html"><meta property="og:site_name" content="ReZero"><meta property="og:description" content="Before that, think more."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://rezeros.github.io/images/redefine-og.webp"><meta property="article:published_time" content="2020-03-07T14:09:00.000Z"><meta property="article:modified_time" content="2025-04-15T23:03:26.483Z"><meta property="article:author" content="ReZero"><meta property="article:tag" content="FrontDesign"><meta property="article:tag" content="Chrome"><meta property="article:tag" content="Plugins"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://rezeros.github.io/images/redefine-og.webp"><link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/redefine-favicon.svg"><title>如何写一个简易的chrome插件 | ReZero&#39;s blog</title><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/build/tailwind.css"><link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="/fonts/Geist/geist.css"><script src="/js/build/libs/anime.min.js"></script><script id="hexo-configurations">window.config={hostname:"rezeros.github.io",root:"/",language:"en",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!0,custom_message:"Advance ruthlessly—whatever the cost!"},open_graph:{enable:!0,image:"/images/redefine-og.webp",description:"Before that, think more."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/wallhaven-wqery6-light.webp",dark:"/images/wallhaven-wqery6-dark.webp"},title:"Before that, think more.",subtitle:{text:[],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,style:"default",links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.2",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Categories:{path:"/categories/",icon:"fa-solid fa-folder"},Tags:{path:"/tags/",icon:"fa-solid fa-tags"}},search:{enable:!1,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,show_on_mobile:!0,links:null},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2022/8/17 11:45:14"},window.lang_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><style>:root{--preloader-background-color:#fff;--preloader-text-color:#000}@media (prefers-color-scheme:dark){:root{--preloader-background-color:#202124;--preloader-text-color:#fff}}@media (prefers-color-scheme:light){:root{--preloader-background-color:#fff;--preloader-text-color:#000}}@media (max-width:600px){.ml13{font-size:2.6rem!important}}.preloader{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;position:fixed;padding:12px;top:0;right:0;bottom:0;left:0;width:100vw;height:100vh;background-color:var(--preloader-background-color);z-index:1100;transition:opacity .2s ease-in-out}.ml13{font-size:3.2rem;color:var(--preloader-text-color);letter-spacing:-1px;font-weight:500;font-family:Chillax-Variable,sans-serif;text-align:center}.ml13 .word{display:inline-flex;flex-wrap:wrap;white-space:nowrap}.ml13 .letter{display:inline-block;line-height:1em}</style><div class="preloader"><h2 class="ml13">Advance ruthlessly—whatever the cost!</h2><script>var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({ loop: true })
            .add({
                targets: '.ml13 .letter',
                translateY: [20, 0],
                translateZ: 0,
                opacity: [0, 1],
                filter: ['blur(5px)', 'blur(0px)'],
                easing: "easeOutExpo",
                duration: 1200,
                delay: (el, i) => 300 + 20 * i,
            })
            .add({
                targets: '.ml13 .letter',
                translateY: [0, -20],
                opacity: [1, 0],
                filter: ['blur(0px)', 'blur(5px)'],
                easing: "easeInExpo",
                duration: 1000,
                delay: (el, i) => 15 * i,
                complete: function() {
                    hidePreloader();
                }
            }, '-=700');


        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }</script></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-title" href="/">ReZero&#39;s blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> HOME</a></li><li class="navbar-item"><a href="/categories/"><i class="fa-solid fa-folder fa-fw"></i> CATEGORIES</a></li><li class="navbar-item"><a href="/tags/"><i class="fa-solid fa-tags fa-fw"></i> TAGS</a></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>HOME </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/"><span>CATEGORIES </span><i class="fa-solid fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags/"><span>TAGS </span><i class="fa-solid fa-tags fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">138</div><div class="label text-third-text-color text-sm">Tags</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">21</div><div class="label text-third-text-color text-sm">Categories</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">60</div><div class="label text-third-text-color text-sm">Posts</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">如何写一个简易的chrome插件</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/redefine-avatar.svg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">ReZero</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2020-03-07 14:09</span> <span class="mobile">2020-03-07 14:09</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-04-15 23:03:26</span> <span class="mobile">2025-04-15 23:03:26</span> <span class="hover-info">Updated</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/FrontDesign/">FrontDesign</a>&nbsp;</li><li>| <a href="/tags/Chrome/">Chrome</a>&nbsp;</li><li>| <a href="/tags/Plugins/">Plugins</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h1 id="如何写一个简易的chrome插件"><a href="#如何写一个简易的chrome插件" class="headerlink" title="如何写一个简易的chrome插件"></a>如何写一个简易的chrome插件</h1><h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p><a class="link" target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/getstarted">https://developer.chrome.com/extensions/getstarted<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><p>推荐阅读官方文档，本文只做简单的演示。</p><blockquote><p>本文图片之类链接打不开，可直接科学上网走外链，参考 <a class="link" target="_blank" rel="noopener" href="https://qqtim.club/2020/03/07/init-chrome-plugin/">原博文<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p></blockquote><h2 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h2><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><ol><li>manifest.json</li></ol><p>可以类比 <code>AndroidManifest</code>，几乎所有的项目都会有一个主配置文件，用来配置全局的基本信息和属性来保证系统的基本启动运行，该文件为 <code>chrome plugin</code> 主配置文件。<br>基于浏览器插件考虑所占体积这个特性，几乎所有关键的配置属性信息都可以在此找到，除了名称，版本等必要的信息，<br><strong>尤为值得关注的几个属性就是</strong></p><ul><li><code>background</code> 改配置属性决定项目启动时会去扫描哪些 js 文件, 然后以此决定需要监听的事件</li></ul><div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><ul><li><code>permission</code> 该属性为权限属性，这个的重要性不必多说，上面的属性注册事件监听时往往需要依赖大量的api，而这些api的权限就依赖于这个 <code>permission</code> 属性</li></ul><div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;storage&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></div><ul><li><code>browser_action</code> 权限和动作都有了，剩下的显然就是渲染的模板文件了，该属性决定了回显需要的大多数配置，包括插件的图标，点击插件时显示的页面等</li></ul><div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icon_16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://developer.chrome.com/static/images/overview/messagingarc.png" alt="概念图"></p><h3 id="重点注意"><a href="#重点注意" class="headerlink" title="重点注意"></a>重点注意</h3><ul><li><p>上面的图中可以看到，插件是基于 <code>message</code> 来互相通信的， 这个 <code>message</code> 后面再说</p></li><li><p><code>Chrome</code> 不允许将 <code>JavaScript</code> 代码段直接内嵌入HTML文档 （inline-script也是被禁止）</p></li></ul><blockquote><p>所以我们需要通过外部引入的方式引用JS文件<br>所以所有元素的事件都需要使用JavaScript代码进行绑定<br>如果你没有使用一个拥有强大选择器的库（jQuery）, 最好给需要绑定事件的元素分配一个id以便进行操作</p></blockquote><ul><li><p><code>&quot;manifest_version&quot;: 2</code>, 这个写 2 吧， 别问为啥</p></li><li><p><code>contentscript.js</code> 这个决定了用户所在的界面操作，emmmm， 就简单理解为通过插件隐性的操作用户的浏览界面，这个这么说明显风险很大，摆明了就是注入 js 搞事的，可以参考个例子： <a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/github_35957188/article/details/54810057">永远点不到的百度按钮<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> 注：文章是很久以前瞎抄的图灵社区来着，可能乱七八糟的，就看个效果就行了，本文只是简单的开发，不会使用各类复杂的属性</p></li><li><p>前面提到的background 属性，有两个可能不是很必要使用的值，一个是 <code>page</code>, 这个是后台配置属性文件，一般需要构建后台页面时才需要。 而 <code>persistent</code> 属性定义了常驻后台的方式（默认为true）——当其值为true时，表示扩展将一直在后台运行，无论其是否正在工作；当其值为false时，表示扩展在后台按需运行，这就是Chrome后来提出的 Event Page, 这个说白了就是按需运行，少耗点内存，不过少耗有什么用呢，chrome嘛，大家都懂的。</p></li></ul><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="开发目标"><a href="#开发目标" class="headerlink" title="开发目标"></a>开发目标</h3><p>实现一个访问日志记录，用来记录当前浏览器发出的请求</p><h3 id="开发日志-项目地址"><a href="#开发日志-项目地址" class="headerlink" title="开发日志  项目地址"></a><a class="link" target="_blank" rel="noopener" href="https://qqtim.club/2020/02/06/request-record/">开发日志<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> <a class="link" target="_blank" rel="noopener" href="https://github.com/ReZeroS/request-record">项目地址<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></h3><ol><li>先从基本配置开始, 如下所示</li></ol><div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Request Record&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Generate the request log and group them by address url&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;debugger&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;tabs&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Request Record&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>我们定义了这个插件的一些基本属性，包括它的名字，描述，版本号,申请权限（这里申请了debugger权限，因为这个权限级别比较高，可以方便开发使用，实际开发是不推荐使用的，另一个tabs权限自然就是tab页相关了）, 以及为其注册了一个后台 js 用来主监听，和默认使用的插件 <code>icon</code></p><blockquote><p>The chrome.debugger API serves as an alternate transport for Chrome’s remote debugging protocol. Use chrome.debugger to attach to one or more tabs to instrument network interaction, debug JavaScript, mutate the DOM and CSS, etc. Use the Debuggee tabId to target tabs with sendCommand and route events by tabId from onEvent callbacks.</p></blockquote><ol start="2"><li>接下来我们在 <code>background.js</code> 中注册基本的监听器</li></ol><div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="property">onClicked</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">tab</span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">attach</span>(&#123;<span class="attr">tabId</span>:tab.<span class="property">id</span>&#125;, version,</span><br><span class="line">      onAttach.<span class="title function_">bind</span>(<span class="literal">null</span>, tab.<span class="property">id</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onAttach</span>(<span class="params">tabId</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (chrome.<span class="property">runtime</span>.<span class="property">lastError</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(chrome.<span class="property">runtime</span>.<span class="property">lastError</span>.<span class="property">message</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  chrome.<span class="property">windows</span>.<span class="title function_">create</span>(</span><br><span class="line">      &#123;<span class="attr">url</span>: <span class="string">&quot;headers.html?&quot;</span> + tabId, <span class="attr">type</span>: <span class="string">&quot;popup&quot;</span>, <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><p>上述使用的api都可以在文末的手册链接中找到，这里只做简单的描述，第一个 <code>browserAction.onClicked</code> 会根据你是否已经 <code>popup</code>(就是你点图标后弹出的小窗) 来决定是否触发， 这个监听器会监听到一个 tabId 从而定位目标的 <code>tab</code> 页。</p></li><li><p>接下来使用 <code>chrome.debugger.attach</code> 使用这个将 <code>debug</code> 目标挂载上，这个 <code>attach</code> 接受三个参数, <a class="link" target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/debugger#type-Debuggee">debuggee 对象<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>， 版本号，和一个回调函数，挂载成功时会触发该回调，失败时会采用类似 <code>C</code> 的异常处理方式，也就是用全局变量去set异常记录。</p></li><li><p>我们在 <code>debugger</code> 成功挂载上目标对象后，创建我们的主页面，开始我们真正的业务代码开发</p></li></ul><ol start="3"><li>业务相关</li></ol><ul><li>前面提到过 <code>chrome</code>, <code>chrome</code> 不允许直接将 <code>js</code> 嵌入文档，所以都是外部引入 <code>js</code> 的，我们这里不引入其他工具型 <code>js</code> 了，直接使用基本的 <code>id</code> 去锁定目标 <code>element</code> 来操作，可以看到总共使用了三部分，一个按钮，用作请求日志的导出，一个 <code>container</code>， 用做基本的渲染展示。</li></ul><div class="code-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-family</span>: monospace;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">word-wrap</span>: break-word;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-id">#container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">white-space</span>: pre;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.request</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;ecl&quot;</span>&gt;</span>export<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;headers.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li>然后我们在 <code>header.js</code> 中，通过 <code>load event</code>， 为页面加载完成后绑定回调方法，在方法中首先使用 <code>sendCommand</code> 向目标 <code>tab</code> 页发送指令 <code>Network.enable</code> 来启用 <code>web</code> 请求 <code>tracking</code>。在此之后我们开启 <code>debugger</code> 事件监听，通过监听的第二，三个参数可以获取到大部分了想要的数据了（二三个参数分别是 <a target="_blank" rel="noopener" href="https://chromedevtools.github.io/devtools-protocol/tot/Network#type-Request"><code>remote debugging protocol</code></a> 的方法名和方法参数）， 至此所有的资源都准备好了，接下来就是依赖这些资源自行进行开发了</li></ul><div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tabId = <span class="built_in">parseInt</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">sendCommand</span>(&#123;<span class="attr">tabId</span>:tabId&#125;, <span class="string">&quot;Network.enable&quot;</span>);</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="property">onEvent</span>.<span class="title function_">addListener</span>(onEvent);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;unload&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">detach</span>(&#123;<span class="attr">tabId</span>:tabId&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><ul><li>最后，以我写的简单小插件作为最后 onEvent 监听器样例吧，代码风格很糟，草草起手，加上我专项是后端，前端的原生 <code>js</code> 并不熟悉，所以仅仅加了注释方便参考，前面核心的地方都说了，后面这一点其实可有可无（我就是单纯的根据url进行了个前缀分类然后导出了 <code>csv</code>，而也可以按照http header的状态码（比如403， 懂的都懂）或者任意信息做个类似的），大家按自己的需求开发即可【Dev tools network 的 abilities 都有了还有啥做不出来 -_-】</li></ul><div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">onEvent</span>(<span class="params">debuggeeId, message, params</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (tabId != debuggeeId.<span class="property">tabId</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (message == <span class="string">&quot;Network.requestWillBeSent&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> requestDiv = requests[params.<span class="property">requestId</span>];</span><br><span class="line">    <span class="keyword">if</span> (!requestDiv) &#123;</span><br><span class="line">      <span class="keyword">var</span> requestDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">      requestDiv.<span class="property">className</span> = <span class="string">&quot;request&quot;</span>;</span><br><span class="line">      requests[params.<span class="property">requestId</span>] = requestDiv;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="string">&#x27;active&#x27;</span>: <span class="literal">true</span>, <span class="string">&#x27;lastFocusedWindow&#x27;</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">      <span class="comment">// get the function code</span></span><br><span class="line">      <span class="keyword">var</span> tabUrl = tabs[<span class="number">0</span>].<span class="property">url</span>;</span><br><span class="line">      <span class="keyword">const</span> urlPaths = <span class="title function_">parseURL</span>(tabUrl).<span class="property">fragment</span>.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> functionCode = urlPaths[<span class="number">3</span>].<span class="title function_">toUpperCase</span>() || urlPaths[<span class="number">2</span>].<span class="title function_">toUpperCase</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// existRequest[tabUrl] = parseURL(params.request.url).path;</span></span><br><span class="line">      <span class="comment">// trim the requests and format them to request object which got two attributes: method &amp; url</span></span><br><span class="line">      <span class="keyword">const</span> requestUrlWithArgs = <span class="title function_">parseURL</span>(params.<span class="property">request</span>.<span class="property">url</span>).<span class="property">path</span>;</span><br><span class="line">      <span class="keyword">let</span> requestUrl = requestUrlWithArgs;</span><br><span class="line">      <span class="keyword">if</span>(requestUrlWithArgs.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">        requestUrl = requestUrlWithArgs.<span class="title function_">split</span>(<span class="string">&quot;?&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//valid url not request for css, js, etc ...</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_">indexOfArray</span>(fileUrls, requestUrl)) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// format number to &#123;id&#125;, a2-b0-cq to &#123;oid&#125;, and a_z to &#123;code&#125;</span></span><br><span class="line">      <span class="keyword">let</span> requestObject = &#123;&#125;;</span><br><span class="line">      requestObject.<span class="property">method</span> = params.<span class="property">request</span>.<span class="property">method</span>;</span><br><span class="line">      requestObject.<span class="property">url</span> = <span class="title function_">formatUrl</span>(requestUrl);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// create such a struct: include key &amp; value which key is function code and value is a list contanis unique requests </span></span><br><span class="line">      <span class="title function_">pushIfNotPresent</span>(existRequest, functionCode, requestObject, </span><br><span class="line">        <span class="function">(<span class="params">src, dest</span>) =&gt;</span> &#123; <span class="keyword">return</span> src.<span class="property">method</span> === dest.<span class="property">method</span> &amp;&amp; src.<span class="property">url</span> === dest.<span class="property">url</span>; &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> requestLine = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;pre&quot;</span>);</span><br><span class="line">      requestLine.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(existRequest, <span class="literal">null</span>, <span class="number">4</span>);</span><br><span class="line">      requestDiv.<span class="title function_">appendChild</span>(requestLine);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> containerNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;container&quot;</span>);</span><br><span class="line">      <span class="keyword">while</span> (containerNode.<span class="property">firstChild</span>) &#123;</span><br><span class="line">        containerNode.<span class="title function_">removeChild</span>(containerNode.<span class="property">firstChild</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      containerNode.<span class="title function_">appendChild</span>(requestDiv);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>附一张截图</li></ul><p><img lazyload src="/images/loading.svg" data-src="https://raw.githubusercontent.com/ReZeroS/request-record/master/json.png" alt="插件样例图"></p><h2 id="推荐查询手册"><a href="#推荐查询手册" class="headerlink" title="推荐查询手册"></a>推荐查询手册</h2><p><a class="link" target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/api_index">Chrome 插件API文档<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><p><a class="link" target="_blank" rel="noopener" href="https://chromedevtools.github.io/devtools-protocol/tot/Debugger">Chrome 开发协议相关<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><h2 id="懒推广"><a href="#懒推广" class="headerlink" title="懒推广"></a>懒推广</h2><p>插件怎么写都说了，以后应该也不会写类似的文章，这里就顺便说下我自己用的一些插件，老实说并不常用，但是偶尔用上就莫名被爽到。</p><p><img lazyload src="/images/loading.svg" data-src="https://raw.githubusercontent.com/ReZeroS/request-record/master/%E6%89%B9%E6%B3%A8%202020-03-07%20140017.png" alt="chrome 插件"></p><p><a class="link" target="_blank" rel="noopener" href="https://github.com/ReZeroS/request-record">https://github.com/ReZeroS/request-record<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><h2 id="This-post-is-used-to-explain-how-to-write-the-plugin-request-record"><a href="#This-post-is-used-to-explain-how-to-write-the-plugin-request-record" class="headerlink" title="This post is used to explain how to write the plugin: request-record."></a>This post is used to explain how to write the plugin: request-record.</h2><p>I got a mission this week to record all api from function requests in our system. I have finished it, but I still wanna to write a plugin to simplify this work. Well, it maybe does not work well, so just write for fun.</p><h3 id="First-step-bulid-the-setting"><a href="#First-step-bulid-the-setting" class="headerlink" title="First step: bulid the setting"></a>First step: bulid the setting</h3><p>Most project should be included a setting file which is used to describe the whole project base setting such like common properties, version number, etc…</p><p>Chrome extension got this file called <code>manifest.json</code>.</p><div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Request Record&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Generate the request log and group them by address url&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;debugger&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;tabs&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Request Record&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><p>The <code>permissions</code> field tells the permissions it required and <code>background</code> field tells the background scripts should be registered.<br>If u still don’t know what is the above mean, u can just write it down and skip this.</p><h3 id="Second-step-render-the-page"><a href="#Second-step-render-the-page" class="headerlink" title="Second step: render the page"></a>Second step: render the page</h3><p>Since we finished the first step, the only info we can infer to is the <code>background</code> field tell <code>background.js</code>, let’s write it.</p><div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="property">onClicked</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">tab</span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">attach</span>(&#123;<span class="attr">tabId</span>:tab.<span class="property">id</span>&#125;, version,</span><br><span class="line">      onAttach.<span class="title function_">bind</span>(<span class="literal">null</span>, tab.<span class="property">id</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onAttach</span>(<span class="params">tabId</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (chrome.<span class="property">runtime</span>.<span class="property">lastError</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(chrome.<span class="property">runtime</span>.<span class="property">lastError</span>.<span class="property">message</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  chrome.<span class="property">windows</span>.<span class="title function_">create</span>(</span><br><span class="line">      &#123;<span class="attr">url</span>: <span class="string">&quot;headers.html?&quot;</span> + tabId, <span class="attr">type</span>: <span class="string">&quot;popup&quot;</span>, <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>Chrome support <code>chrome</code> object to provide the api for developer to access the browser. And u can see them all from <a class="link" target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/api_index">here<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>. The listener we registered will fire when a browser action icon is clicked while does not fire if the browser action has a popup. We use the listener to capture the tab and pass it to debugger which can attach to it to instrument network interaction, debug JavaScript, mutate the DOM and CSS, etc. Use the Debuggee tabId to target tabs with sendCommand and route events by tabId from onEvent callbacks.</p><p>After we bind the chrome tab we can write the real work code and got the error message at runtime.</p><h3 id="Third-step-build-the-app"><a href="#Third-step-build-the-app" class="headerlink" title="Third step: build the app"></a>Third step: build the app</h3><p>The follow template shows how to bind listener to the window we created last step and capture the web request.<br>The <code>Network.enable</code> varible which defined by the <a class="link" target="_blank" rel="noopener" href="https://chromedevtools.github.io/devtools-protocol/tot/Network">remote debugging protocol<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> could enable network tracking, and then network events will be delivered to the client.</p><div class="code-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tabId = <span class="built_in">parseInt</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">sendCommand</span>(&#123;<span class="attr">tabId</span>:tabId&#125;, <span class="string">&quot;Network.enable&quot;</span>);</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="property">onEvent</span>.<span class="title function_">addListener</span>(onEvent);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;unload&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">debugger</span>.<span class="title function_">detach</span>(&#123;<span class="attr">tabId</span>:tabId&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p><code>onEvent</code> function got three params: <code>debuggeeId, message, params</code>, u can use them to write what u want.</p><p>Here I wanna to record the request log, so I intercept at the <code>requestWillBeSent</code>, and get the request from the params, get the tab url by using <code>chrome.tabs.query</code>.</p><h3 id="Last-step-load-your-package"><a href="#Last-step-load-your-package" class="headerlink" title="Last step: load your package"></a>Last step: load your package</h3><p>After last three steps, we can open the extension tab and load from unzip folder which we created, then u can see it.</p></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> 如何写一个简易的chrome插件</li><li><strong>Author:</strong> ReZero</li><li><strong>Created at :</strong> 2020-03-07 14:09:00</li><li><strong>Updated at :</strong> 2025-04-15 23:03:26</li><li><strong>Link:</strong> https://rezeros.github.io/2020/03/07/init-chrome-plugin/</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/FrontDesign/">#FrontDesign</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/Chrome/">#Chrome</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/Plugins/">#Plugins</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2020/03/08/init-spider/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">如何写一个简易的爬虫</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2019/08/21/liquibase/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">liquibase</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">Comments</div><div id="giscus-container"></div><script data-swup-reload-script defer>async function loadGiscus(){const t={src:"https://giscus.app/client.js","data-repo":"rezeros/rezeros.github.io","data-repo-id":"MDEwOlJlcG9zaXRvcnkxNjk3MzU3NzA=","data-category":"Announcements","data-category-id":"DIC_kwDOCh32Ws4Co2GO","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"1","data-theme":"preferred_color_scheme","data-lang":"en","data-input-position":"bottom","data-loading":"not-lazy",crossorigin:"anonymous",async:!0},a=document.createElement("script");for(const e in t)a.setAttribute(e,t[e]);document.getElementById("giscus-container").appendChild(a)}{let t=setTimeout(()=>{loadGiscus(),clearTimeout(t)},1e3)}</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">如何写一个简易的chrome插件</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84chrome%E6%8F%92%E4%BB%B6"><span class="nav-text">如何写一个简易的chrome插件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="nav-text">推荐阅读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="nav-text">概念介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="nav-text">基本配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E7%82%B9%E6%B3%A8%E6%84%8F"><span class="nav-text">重点注意</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%9B%AE%E6%A0%87"><span class="nav-text">开发目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97-%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80"><span class="nav-text">开发日志 项目地址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C"><span class="nav-text">推荐查询手册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%87%92%E6%8E%A8%E5%B9%BF"><span class="nav-text">懒推广</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#This-post-is-used-to-explain-how-to-write-the-plugin-request-record"><span class="nav-text">This post is used to explain how to write the plugin: request-record.</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#First-step-bulid-the-setting"><span class="nav-text">First step: bulid the setting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Second-step-render-the-page"><span class="nav-text">Second step: render the page</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Third-step-build-the-app"><span class="nav-text">Third step: build the app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Last-step-load-your-package"><span class="nav-text">Last step: load your package</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2022</span> - 2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">ReZero</a><p class="post-count space-x-0.5"><span>60 posts in total</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="/js/build/libs/Swup.min.js"></script><script src="/js/build/libs/SwupSlideTheme.min.js"></script><script src="/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="/js/build/libs/SwupProgressPlugin.min.js"></script><script src="/js/build/libs/SwupScrollPlugin.min.js"></script><script src="/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/build/tools/imageViewer.js" type="module"></script><script src="/js/build/utils.js" type="module"></script><script src="/js/build/main.js" type="module"></script><script src="/js/build/layouts/navbarShrink.js" type="module"></script><script src="/js/build/tools/scrollTopBottom.js" type="module"></script><script src="/js/build/tools/lightDarkSwitch.js" type="module"></script><script src="/js/build/layouts/categoryList.js" type="module"></script><script src="/js/build/tools/codeBlock.js" type="module"></script><script src="/js/build/layouts/lazyload.js" type="module"></script><script src="/js/build/tools/runtime.js"></script><script src="/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/build/libs/Typed.min.js"></script><script src="/js/build/plugins/typed.js" type="module"></script><script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script><script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script><script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script><script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script><script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script></body></html>